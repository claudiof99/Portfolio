<%- include('../partials/header') %>
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h1 class="mb-0">6. Planning (Risk Management)</h1>
        <p class="text-muted mb-0">Identify risks and opportunities</p>
    </div>
    <a href="/iso" class="btn btn-outline-secondary">
        Back to ISO Hub
    </a>
</div>
<% if (currentUser && (currentUser.role === 'quality_manager' || currentUser.role === 'admin')) { %>
    <div class="card mb-4 border-warning">
        <div class="card-header bg-warning text-dark">Add New Risk</div>
        <div class="card-body">
            <form action="/iso/planning/add" method="POST" class="row g-2">
                <div class="col-md-6"><input name="description" class="form-control" placeholder="Risk Description" required></div>
                <div class="col-md-2"><input type="number" name="prob" class="form-control" placeholder="Prob (1-5)" min="1" max="5"></div>
                <div class="col-md-2"><input type="number" name="impact" class="form-control" placeholder="Impact (1-5)" min="1" max="5"></div>
                <div class="col-md-2"><button class="btn btn-dark w-100">Add</button></div>
            </form>
        </div>
    </div>
<% } %>

<table class="table table-hover">
    <thead><tr><th>Description</th><th>Probability</th><th>Impact</th><th>Risk Score</th></tr></thead>
    <tbody>
        <% risks.forEach(r => { %>
            <tr class="<%= r.score >= 15 ? 'table-danger' : (r.score >= 8 ? 'table-warning' : 'table-success') %>">
                <td><%= r.description %></td>
                <td><%= r.prob %></td>
                <td><%= r.impact %></td>
                <td><strong><%= r.score %></strong></td>
            </tr>
        <% }) %>
    </tbody>
</table>
<%- include('../partials/footer') %>