<%- include('partials/header') %>

<h1 class="mb-4">Dashboard</h1>

<% if (currentUser && (currentUser.role === 'quality_manager' || currentUser.role === 'admin')) { %>
  <div class="alert alert-light border border-warning shadow-sm mb-4">
    <div class="d-flex align-items-center">
      <div class="flex-grow-1">
        <h5 class="alert-heading text-warning mb-1">Action Required</h5>
        <p class="mb-0">You have data entries awaiting validation.</p>
      </div>
      <a href="/kpis/approvals" class="btn btn-warning">Review Pending Approvals</a>
    </div>
  </div>
<% } %>

<h3 class="mb-3">Main Sections</h3>
<div class="row">

  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-primary">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title text-primary"><i class="fas fa-book me-2"></i>ISO Hub</h5>
        <p class="text-muted flex-grow-1">Central area for all ISO 9001 documentation, context, and leadership.</p>
        <a href="/iso" class="btn btn-primary mt-3">Open Hub</a>
      </div>
    </div>
  </div>

  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-info">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title text-info"><i class="fas fa-chart-line me-2"></i>KPIs</h5>
        <p class="text-muted flex-grow-1">View, add, edit, and remove Key Performance Indicators.</p>
        <a href="/kpis" class="btn btn-outline-info mt-3 text-dark">Manage KPIs</a>
      </div>
    </div>
  </div>

  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-success">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title text-success"><i class="fas fa-table me-2"></i>Resources</h5>
        <p class="text-muted flex-grow-1">Manage resources, equipment lists, and supplier data.</p>
        <a href="/tables" class="btn btn-outline-success mt-3">View Tables</a>
      </div>
    </div>
  </div>

  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-warning">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title text-warning"><i class="fas fa-exclamation-triangle me-2"></i>Issues (NCs)</h5>
        <p class="text-muted flex-grow-1">Report defects, non-conformities, and corrective actions.</p>
        <a href="/ncs" class="btn btn-warning mt-3 text-dark">Report Issue</a>
      </div>
    </div>
  </div>

  <div class="col-md-4 col-lg-3 mb-4">
    <div class="card h-100 shadow-sm border-secondary">
      <div class="card-body d-flex flex-column">
        <h5 class="card-title text-secondary"><i class="fas fa-chart-pie me-2"></i>Analysis</h5>
        <p class="text-muted flex-grow-1">Generate and view graphs representing KPI performance trends.</p>
        <a href="/graphs" class="btn btn-outline-secondary mt-3">View Graphs</a>
      </div>
    </div>
  </div>

</div>

<hr class="my-4">

<div class="row">
  <div class="col-md-6 mb-3">
    <h3>Unread Notifications <span class="badge bg-danger rounded-pill"><%= notifications.length %></span></h3>
    <ul class="list-group list-group-flush border rounded bg-white shadow-sm">
      <% if (notifications.length > 0) { %>
        <% notifications.forEach(n => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <a href="<%= n.link || '#' %>" class="text-decoration-none text-dark"><%= n.message %></a>
            <small class="text-muted"><%= new Date(n.createdAt).toLocaleDateString() %></small>
          </li>
        <% }) %>
      <% } else { %>
        <li class="list-group-item text-muted text-center p-3">No new notifications.</li>
      <% } %>
    </ul>
  </div>

  <div class="col-md-6 mb-3">
    <h3>My Complaints & Tasks</h3>
    <ul class="list-group list-group-flush border rounded bg-white shadow-sm">
      <% if (complaints.length > 0) { %>
        <% complaints.forEach(c => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
                <strong><%= c.title || 'Complaint #' + c.id %></strong><br>
                <small class="text-muted">Assigned to you</small>
            </div>
            <span class="badge bg-<%= c.status === 'Open' ? 'warning' : 'success' %>"><%= c.status %></span>
          </li>
        <% }) %>
      <% } else { %>
        <li class="list-group-item text-muted text-center p-3">You have no active complaints.</li>
      <% } %>
    </ul>
  </div>
</div>

<%- include('partials/footer') %>